---
title: react闭包问题。
date: '2021-11-11'
tags: ['react', 'hooks']
draft: false
summary: 'react闭包常见解决方案'
---

hooks 函数状态（props & state）更新时，会重新调用当前函数；

调用时整个函数作用域取的是当前上下文的状态及变量；

如果做一些异步操作时在不更新组件内部状态的情况下 就不会重新调用组件函数；

所以拿到的值只能是上一次函数状态更新时调用时的上下文。

常见场景及解决办法：

一、hooks 拿不到最新状态时：

1.通过 useRef 来存取数据；

2. setState(x=>x)方式获取；

二、利用闭包场景，比如自定义防抖 hooks 等

通过 useCallback 缓存函数 在状态更新时 每次都读取之前闭包函数的变量 而非重新创建
